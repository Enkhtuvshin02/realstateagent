<!DOCTYPE html>
<html lang="mn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Үл хөдлөх хөрөнгийн туслах</title>
    <!-- Үндсэн загварын CSS -->
    <link rel="stylesheet" href="/static/css/chat.css">
    
    <!-- JavaScript функцууд -->
    <script src="/static/js/chat.js"></script>
















            // Кэшийг шинэчлэх
            window.refreshCache = async function() {
                try {
                    statusSpan.textContent = 'Мэдээлэл шинэчилж байна...';
                    cacheStatusSpan.textContent = 'Шинэчилж байна...';

                    const response = await fetch('/cache/refresh', { method: 'POST' });
                    const data = await response.json();

                    if (data.status === 'success') {
                        cacheStatusSpan.textContent = 'Шинэчлэгдсэн';
                        addMessage('✅ Дүүргийн мэдээлэл амжилттай шинэчлэгдлээ!', 'assistant');
                    } else {
                        cacheStatusSpan.textContent = 'Алдаа';
                        addMessage('❌ Мэдээлэл шинэчлэхэд алдаа гарлаа.', 'assistant');
                    }

                    statusSpan.textContent = 'Бэлэн байна';
                } catch (error) {
                    console.error('Cache refresh error:', error);
                    cacheStatusSpan.textContent = 'Алдаа';
                    statusSpan.textContent = 'Алдаа';
                }
            }

            // Системийн статусыг шалгах
            async function checkStatus() {
                try {
                    const [healthResponse, cacheResponse] = await Promise.all([
                        fetch('/health'),
                        fetch('/cache/status')
                    ]);

                    const healthData = await healthResponse.json();
                    const cacheData = await cacheResponse.json();

                    if (healthData.all_ready) {
                        statusSpan.textContent = 'Бэлэн байна';
                    } else {
                        statusSpan.textContent = 'Эхлүүлж байна...';
                    }

                    if (cacheData.status === 'success' && cacheData.cache.is_fresh) {
                        cacheStatusSpan.textContent = `Шинэ (${cacheData.cache.age_days || 0} өдөр)`;
                    } else {
                        cacheStatusSpan.textContent = 'Хуучирсан';
                    }

                } catch (error) {
                    console.error('Status check error:', error);
                    statusSpan.textContent = 'Алдаа';
                    cacheStatusSpan.textContent = 'Тодорхойгүй';
                }
            }

            // Эхлүүлэх
            checkStatus();
            userInput.focus();

            // Тогтмол статус шалгах
            setInterval(checkStatus, 30000);
        });
    </script>
</head>
<body>
    <div class="chat-container">
        <div class="chat-header">
            <h1>Үл хөдлөх хөрөнгийн туслах</h1>
            <p>Орон сууц, дүүрэг, зах зээлийн мэргэжлийн шинжилгээ</p>
        </div>

        <div class="status-bar">
            <div class="status-indicator">
                <div class="status-dot"></div>
                <span id="status">Бэлэн байна</span>
            </div>
            <div>
                <span id="cache-status">Кэш шалгаж байна...</span>
            </div>
        </div>

        <div class="chat-messages" id="chat-messages">
            <div class="message assistant">
                <div class="assistant-label">Туслах</div>
                <div class="message-content">
                    <p>Сайн байна уу! Би Улаанбаатар хотын үл хөдлөх хөрөнгийн туслах.</p>
                    
                    <p><strong>Миний чадварууд:</strong></p>
                    <p>• Unegui.mn-ээс орон сууцны мэдээлэл татах<br>
                    • Дүүргүүдийн үнэ харьцуулах<br>
                    • Интернэтээс зах зээлийн мэдээлэл хайх<br>
                    • Дэлгэрэнгүй PDF тайлан үүсгэх<br>
                    • Алхам бүрийн шинжилгээтэй хариулт</p>

                    <p>Та орон сууцны холбоос илгээх эсвэл дүүргийн талаар асуух боломжтой.</p>
                </div>
            </div>
        </div>

        <div class="loading" id="loading">
            <span class="loading-dots">Шинжилгээ хийж байна</span>
        </div>

        <div class="chat-input-container">
            <form class="chat-form" id="chat-form">
                <textarea
                    class="chat-input"
                    id="user-input"
                    placeholder="Орон сууцны холбоос эсвэл асуулт бичнэ үү..."
                    rows="1"
                ></textarea>
                <button type="submit" class="send-button" id="send-button">Илгээх</button>
            </form>

            <div class="quick-actions">
                <div class="quick-action" onclick="sendQuickMessage('Сүхбаатар дүүрэг')">Сүхбаатар дүүрэг</div>
                <div class="quick-action" onclick="sendQuickMessage('Бүх дүүргийн үнэ харьцуулах')">Дүүрэг харьцуулах</div>
                <div class="quick-action" onclick="sendQuickMessage('Орон сууцны зах зээлийн нөхцөл')">Зах зээлийн нөхцөл</div>
                <div class="quick-action" onclick="refreshCache()">Мэдээлэл шинэчлэх</div>
            </div>
        </div>
    </div>
</body>
</html>